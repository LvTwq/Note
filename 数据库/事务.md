# 一、事务的特性

### 原子性(Atomicity):

事务中的所有操作作为一个整体像原子一样不可分割，要么全部成功，要么全部失败。

### 一致性(Consistency):

事务的执行结果必须使数据库从一个一致性状态到另一个一致性状态。一致性状态是指:

1.系统的状态满足数据的完整性约束(主码，参照完整性，check约束等) 

2.系统的状态反应数据库本应描述的现实世界的真实状态，比如转账前后两个账户的金额总和应该保持不变。

### 隔离性(Isolation):

并发执行的事务不会相互影响，其对数据库的影响和它们串行执行时一样。比如多个用户同时往一个账户转账，最后账户的结果应该和他们按先后次序转账的结果一样。

### 持久性(Durability):

事务一旦提交，其对数据库的更新就是持久的。任何事务或系统故障都不会导致数据丢失。

在事务的ACID特性中，C即一致性是事务的根本追求，而对数据一致性的破坏主要来自两个方面

- 1.事务的并发执行
- 2.事务故障或系统故障

数据库系统是通过并发控制技术和日志恢复技术来避免这种情况发生的。

并发控制技术保证了事务的隔离性，使数据库的一致性状态不会因为并发执行的操作被破坏。
日志恢复技术保证了事务的原子性，使一致性状态不会因事务或系统故障被破坏。同时使已提交的对数据库的修改不会因系统崩溃而丢失，保证了事务的持久性。



# 二、事务的创建

### 隐式事务：

事务没有明显的开启和结束的标记，比如insert，update，delete语句，通过

```sql
SHOW VARIABLES LIKE 'autocommit'
```

可以看到事务是自动开启的

### 显式事务：

事务有明显的开启和结束的标记

1）必须先把自动提交功能设为禁用，可以看到事务被关闭了

```sql
SET autocommit = 0;
SHOW VARIABLES LIKE 'autocommit'
```

2）编写事务中的sql语句（select，insert，update，delete）

3）结束事务

```sql
-- 提交事务
commit;
-- 回滚事务
rollback;
```

注：ddl语句没有事务





# 三、数据库隔离级别

对于同时运行的多个事务，当这些事务访问**数据库中相同的数据**时，如果没有采取必要的隔离机制，就会导致各种并发问题：

* 脏读：对于两个事务T1、T2，T1读取了已经被T2**更新**但还**没有被提交**的字段之后，若T2回滚，T1读取的内容就是临时且无效的
* 不可重复读：对于两个事务T1、T2，T1读取了一个字段，然后T2**更新**了该字段之后，T1再次读取同一个字段，值就不同了
* 幻读：对于两个事务T1、T2，T1从一个表中读取了一个字段，然后在该表中**插入**了一些新的行之后，如果T1再次读取同一张表，就会多出几行

可以通过设置隔离级别来避免并发问题。



